<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syg Ku Tintakuu</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíñ</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;700;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; overflow: hidden; }
        #dynamic-bg { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: -20; background-size: 400% 400%; animation: gradientGerak 8s ease infinite; transition: background-image 0.5s ease-in-out; }
        @keyframes gradientGerak { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .theme-ungu { background-image: linear-gradient(-45deg, #240046, #7b2cbf, #ff006e, #3c096c); }
        .theme-cyber { background-image: linear-gradient(-45deg, #ff00cc, #333399, #00ccff, #ffcc00); }
        .theme-lava { background-image: linear-gradient(-45deg, #590d22, #a4133c, #ff4d6d, #ffb703); }
        .theme-ocean { background-image: linear-gradient(-45deg, #000428, #004e92, #00c6ff, #0072ff); }
        .theme-sunset { background-image: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); }
        .glass { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); }
        #chat-box::-webkit-scrollbar { width: 4px; }
        #chat-box::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.5); border-radius: 10px; }
        .photo-floater { position: absolute; bottom: -300px; pointer-events: none; z-index: 50; animation: floatUpPhoto linear forwards; background-color: white; padding: 8px 8px 25px 8px; box-shadow: 0 10px 20px rgba(0,0,0,0.25); border-radius: 4px; transform-origin: center; }
        .photo-floater img { width: 100%; height: 100%; object-fit: cover; border-radius: 2px; display: block; }
        @keyframes floatUpPhoto { 0% { transform: translateY(0) rotate(var(--rot-start)) scale(0.8); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-120vh) rotate(var(--rot-end)) scale(1); opacity: 0; } }
        .heart-img { position: absolute; z-index: -5; pointer-events: none; animation: floatHeart linear forwards; opacity: 0.8; filter: drop-shadow(0 0 10px rgba(255,255,255,0.4)); }
        @keyframes floatHeart { 0% { transform: translateY(110vh) scale(0.5); opacity: 0; } 20% { opacity: 0.7; } 80% { opacity: 0.7; } 100% { transform: translateY(-10vh) scale(1.2); opacity: 0; } }
    </style>
</head>
<body class="h-screen flex items-center justify-center relative overflow-hidden">

    <div id="dynamic-bg" class="theme-ungu"></div>
    <div id="heart-container" class="absolute inset-0 w-full h-full overflow-hidden pointer-events-none"></div>

    <div class="absolute top-6 right-6 z-[60] flex gap-2">
        <button id="btn-party" onclick="muncratkan()" class="bg-white/20 hover:bg-white/40 text-white w-14 h-14 rounded-full backdrop-blur-md border border-white/30 shadow-lg active:scale-90 transition text-2xl animate__animated" title="Show Love!">üì∏</button>
        <button onclick="changeTheme()" class="bg-white/20 hover:bg-white/40 text-white px-5 py-3 rounded-full backdrop-blur-md border border-white/30 shadow-lg active:scale-95 transition font-bold text-sm flex items-center gap-2"><span>üé®</span> <span id="btn-text">Ganti Vibe</span></button>
    </div>

    <div class="glass p-8 md:p-12 rounded-[2.5rem] text-center shadow-2xl w-[90%] max-w-md relative z-10 flex flex-col max-h-[85vh] border-t border-l border-white/40">
        <div class="mb-4 animate__animated animate__fadeInDown">
            <h1 class="text-6xl md:text-7xl font-extrabold text-white tracking-tighter leading-none drop-shadow-lg">syg ku<span class="inline-block animate__animated animate__heartBeat animate__infinite text-purple-300 text-5xl align-middle ml-2">üíñ</span></h1>
            <h1 class="text-5xl md:text-6xl font-extrabold text-white tracking-tighter leading-none drop-shadow-lg mt-2">tintakuu<span class="inline-block animate__animated animate__heartBeat animate__infinite text-pink-300 text-5xl align-middle ml-2" style="animation-delay: 0.5s">üíñ</span></h1>
            <p class="text-white/80 text-xs font-bold tracking-[0.4em] mt-4 uppercase">My Favorite Person</p>
        </div>
        
        <div class="flex-1 flex flex-col min-h-0 bg-black/20 rounded-2xl p-4 border border-white/10 shadow-inner">
            <div id="chat-box" class="flex-1 overflow-y-auto mb-3 pr-2 space-y-3">
                <div class="text-center text-white/50 text-xs py-10 italic">Menghubungkan ke hati... ‚è≥</div>
            </div>
            <div class="flex gap-2 relative mt-2">
                <input type="text" id="msg-input" class="w-full bg-white/10 border border-white/20 rounded-full pl-5 pr-12 py-3 text-white placeholder-white/60 focus:outline-none focus:bg-white/25 focus:border-purple-300 transition-all text-sm font-medium shadow-sm" placeholder="Kirim pesan..." autocomplete="off">
                <button id="send-btn" class="absolute right-1 top-1 bottom-1 bg-gradient-to-br from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400 text-white w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-lg group active:scale-90">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 group-hover:rotate-45 transition-transform"><path d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z" /></svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const themes = ['theme-ungu', 'theme-cyber', 'theme-lava', 'theme-ocean', 'theme-sunset'];
        let currentIndex = 0;
        function changeTheme() {
            currentIndex = (currentIndex + 1) % themes.length;
            const bg = document.getElementById('dynamic-bg');
            bg.classList.remove(...themes); bg.classList.add(themes[currentIndex]);
            const txt = document.getElementById('btn-text');
            txt.innerText = "‚ú® Magic!"; setTimeout(() => txt.innerText = "Ganti Vibe", 500);
        }

        const myPhotos = [];
        for(let i = 1; i <= 10; i++) { myPhotos.push(`foto (${i}).jpg`); }

        function spawnPhoto(isFast = false) {
            const frame = document.createElement('div'); frame.classList.add('photo-floater');
            const img = document.createElement('img');
            img.src = myPhotos[Math.floor(Math.random() * myPhotos.length)];
            img.onerror = function() { this.style.display = 'none'; frame.innerText = "Foto 404"; };
            frame.appendChild(img);
            frame.style.left = Math.random() * 85 + 'vw';
            frame.style.width = (Math.floor(Math.random() * 90) + 130) + 'px';
            frame.style.setProperty('--rot-start', (Math.random() * 40 - 20) + 'deg');
            frame.style.setProperty('--rot-end', (Math.random() * 360) + 'deg');
            const duration = isFast ? (Math.random() * 3 + 2) : (Math.random() * 5 + 5);
            frame.style.animationDuration = duration + 's';
            document.body.appendChild(frame);
            setTimeout(() => { frame.remove(); }, duration * 1000);
        }

        function muncratkan() {
            const btn = document.getElementById('btn-party'); btn.classList.add('animate__rubberBand');
            setTimeout(() => btn.classList.remove('animate__rubberBand'), 800);
            for(let i=0; i<12; i++) { setTimeout(() => { spawnPhoto(true); }, i * 150); }
        }
        setInterval(() => spawnPhoto(false), 3000);

        const heartSrc = "https://upload.wikimedia.org/wikipedia/commons/4/42/Love_Heart_SVG.svg";
        function spawnHeart() {
            const img = document.createElement('img'); img.src = heartSrc; img.classList.add('heart-img');
            img.style.left = ((Math.random() * 120) - 10) + 'vw';
            img.style.width = ((Math.random() * 60) + 20) + 'px';
            img.style.filter = `hue-rotate(${Math.floor(Math.random() * 360)}deg) drop-shadow(0 0 5px rgba(255,255,255,0.5))`;
            const duration = (Math.random() * 6) + 6; img.style.animationDuration = duration + 's';
            document.getElementById('heart-container').appendChild(img);
            setTimeout(() => { img.remove(); }, duration * 1000);
        }
        setInterval(spawnHeart, 600);
    </script>

    <script type="module">
        // 1. IMPORT AUTH JUGA (PENTING!)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        console.log("üöÄ 1. SCRIPT MULAIII!!");

        const firebaseConfig = {
            apiKey: "AIzaSyA9Ofp0v-rc0Z8iK98APBXrA3mSA9K_5X0",
            authDomain: "sayang-ff5b2.firebaseapp.com",
            projectId: "sayang-ff5b2",
            storageBucket: "sayang-ff5b2.firebasestorage.app",
            messagingSenderId: "615657253892",
            appId: "1:615657253892:web:768e3a8690fa0547a69951"
        };

        // 2. Init App & Auth
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const chatBox = document.getElementById('chat-box');
        const msgInput = document.getElementById('msg-input');
        const sendBtn = document.getElementById('send-btn');

        // 3. LOGIN ANONYMOUS DULU
        console.log("üîê Sedang mencoba login anonymous...");
        
        signInAnonymously(auth)
            .then(() => {
                console.log("‚úÖ Berhasil Login Anonymous!");
            })
            .catch((error) => {
                console.error("‚ùå Gagal Login:", error);
                chatBox.innerHTML = `<div class="text-red-300 text-xs py-10">Gagal Login: ${error.message}</div>`;
            });

        // 4. PANTENGIN STATUS LOGIN
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // KALAU SUDAH LOGIN, BARU BISA BACA CHAT
                console.log("üë§ User ID:", user.uid);
                setupRealtimeListener();
            } else {
                console.log("User belum login");
            }
        });

        // --- Fungsi Kirim Pesan ---
        async function kirimPesan() {
            const text = msgInput.value;
            
            if (text.trim() === "") return;

            const btnText = sendBtn.innerHTML;
            sendBtn.innerHTML = "‚è≥";
            sendBtn.disabled = true;

            try {
                await addDoc(collection(db, "messages"), {
                    text: text,
                    sender: "Aku",
                    uid: auth.currentUser ? auth.currentUser.uid : "anon", // Simpan ID pengirim
                    createdAt: serverTimestamp()
                });
                console.log("‚úÖ Terkirim!");
                msgInput.value = "";
            } catch (e) {
                console.error("‚ùå ERROR KIRIM:", e);
                alert("Gagal kirim: " + e.message);
            } finally {
                sendBtn.innerHTML = btnText;
                sendBtn.disabled = false;
            }
        }

        sendBtn.addEventListener('click', kirimPesan);
        msgInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') kirimPesan(); });

        // --- Fungsi Dengar Chat (Dipanggil setelah login) ---
        function setupRealtimeListener() {
            const q = query(collection(db, "messages"), orderBy("createdAt", "asc"));
            
            onSnapshot(q, (snapshot) => {
                console.log("üì• Data masuk! Jumlah:", snapshot.size);
                chatBox.innerHTML = "";
                
                if (snapshot.empty) {
                    chatBox.innerHTML = '<div class="text-center text-white/50 text-xs py-10 italic">Belum ada pesan...<br>Klik tombol kamera üì∏ di pojok kanan!</div>';
                    return;
                }

                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const div = document.createElement('div');
                    
                    // Cek apakah pesan dari diri sendiri atau orang lain (opsional)
                    // Disini kita buat rata kanan semua dulu
                    div.className = "flex justify-end animate__animated animate__fadeInUp animate__faster";
                    
                    div.innerHTML = `
                        <div class="bg-white/20 backdrop-blur-md text-white px-4 py-2 rounded-2xl rounded-tr-none border border-white/20 shadow-sm max-w-[80%] text-left">
                            <p class="text-sm font-medium leading-relaxed">${data.text ? data.text.replace(/</g, "&lt;") : ''}</p>
                        </div>
                    `;
                    chatBox.appendChild(div);
                });
                chatBox.scrollTop = chatBox.scrollHeight;
            }, (error) => {
                console.error("‚ùå ERROR BACA DATA:", error);
            });
        }
    </script>
</body>
</html>